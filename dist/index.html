<!DOCTYPE html>
<html>
    <head>
        <title>Example | color-robin</title>
        <script src="color-robin.js"></script>
        <style>
            h1 {font-size: 2em;}
            h2 {font-size: 1.5em;}

            body {
                padding: 5%;
                background-color: #fafafa;
                text-align: center;
                font-family: Sans-serif;
            }

            .fork-me {
                position: fixed;
                top: 0;
                right: 0;
            }
        </style>
    </head>
    <body>        
        <script>           
            var analyzer = new ColorRobin.Analyzer();

            function onImageLoaded(index) {
                let inputImage = document.getElementById("sample-"+index);
                let colors = analyzer.analyze(inputImage, 150);
                showColors(inputImage.parentElement, colors);
            }

            function showColors(target, colors) {
                for (let i = 0; i < colors.length; i++) {
                    let container = document.createElement('div');
                    container.style.width = "30px";
                    container.style.height = "30px";
                    container.style.display = "inline-block";
                    container.style.backgroundColor = ColorRobin.toRgbString(colors[i].color);
                    target.appendChild(container);
                }
            }
        </script>

        <h1>color-robin</h1>

        <div>
            <h2>Examples</h2>
            <div><img id="sample-1" src="sample-1.jpg" onload="onImageLoaded(1)" style="width:50%;"><br></div>
            <div><img id="sample-2" src="sample-2.jpg" onload="onImageLoaded(2)" style="width:50%;"><br></div>
        </div>

        <hr>

        <div>
            <h2>Performance test</h2>
            <p>* Greater color change tolerance means that more colors will be grouped together, thus less color groups will be produced.</p>
            <button onclick="testPerformance()">Start</button>
            <div id="test-results"></div>
            <script>
                var resultsElem = document.getElementById("test-results");

                function testPerformance() {
                    resultsElem.innerHTML = "";
                    appendToResults("Started...");

                    let inputImage = document.getElementById("sample-1");

                    let totalTime = 0;

                    totalTime += testResolution(inputImage, 20, 500);
                    totalTime += testResolution(inputImage, 50, 500);

                    appendToResults("Total time: "+(totalTime|0)+"ms");
                }

                function testResolution(image, resolution, iterationsPerTest) {
                    let totalTime = 0;

                    totalTime += testAnalysis(image, iterationsPerTest, 200, resolution);
                    totalTime += testAnalysis(image, iterationsPerTest, 100, resolution);
                    totalTime += testAnalysis(image, iterationsPerTest, 50, resolution);

                    let avgImageTime = ((totalTime / iterationsPerTest * 3) * 100 | 0) / 100;
                    appendToResults("Average time per image: " + avgImageTime + "ms");                    

                    return totalTime;
                }

                function testAnalysis(image, iterations, tolerance, resolution) {
                    let startTime = window.performance.now();

                    analyzer.setResolution(resolution);
                    for (let i = 0; i < iterations; i++) {
                        colors = analyzer.analyze(image, tolerance);

                    }
                    let totalTime = ((window.performance.now() - startTime) * 100 | 0) / 100;
                    appendToResults("Analyzed " +iterations+" images (tolerance "+tolerance+", resolution "+resolution+"x"+resolution+") in "+ totalTime + "ms");

                    return totalTime;
                }

                function appendToResults(text) {
                    let elem = document.createElement("p");
                    elem.innerHTML = text;
                    resultsElem.appendChild(elem);
                }
            </script>
        </div>

        <div class="fork-me">
            <a href="https://github.com/ptrgast/color-robin"><img loading="lazy" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_gray_6d6d6d.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
        </div>

    </body>
</html>